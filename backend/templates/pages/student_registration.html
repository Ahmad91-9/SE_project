{% extends "layouts/base.html" %}

{% block page_title %}Student Registrations{% endblock %}

{% block content %}
<section class="p-6 lg:p-10 space-y-10">
    <header>
        <p class="text-sm text-gray-500">Integrated Intake · Students & Societies</p>
        <h1 class="text-3xl font-bold text-gray-900">Event Registration Management</h1>
    </header>

    <div class="grid lg:grid-cols-3 gap-6">
        <article class="card">
            <p class="text-xs uppercase tracking-[0.3em] text-gray-400">Total Registered</p>
            <p class="text-3xl font-bold text-gray-900 mt-2">{{ registrations|length }}</p>
        </article>
        <article class="card">
            <p class="text-xs uppercase tracking-[0.3em] text-gray-400">Events Open</p>
            <p class="text-3xl font-bold text-gray-900 mt-2">{{ events|length }}</p>
        </article>
        <article class="card">
            <p class="text-xs uppercase tracking-[0.3em] text-gray-400">Pending Approvals</p>
            <p class="text-3xl font-bold text-gray-900 mt-2">{{ registrations|selectattr('status','equalto','pending')|list|length }}</p>
        </article>
    </div>

    <div class="card">
        <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
            <div>
                <h2 class="text-xl font-semibold">Submit a New Registration</h2>
                <p class="text-sm text-gray-500">Students can self-register for campus events</p>
            </div>
        </div>
        <form id="student-registration-form" class="grid md:grid-cols-2 gap-4">
            <div>
                <label class="form-label">Student Name</label>
                <input name="student_name" class="form-input" placeholder="Ahmed Khan" required>
            </div>
            <div>
                <label class="form-label">Student ID</label>
                <input name="student_id" class="form-input" placeholder="UOS2022XXXX" required>
            </div>
            <div>
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-input" placeholder="student@uos.edu.pk" required>
            </div>
            <div>
                <label class="form-label">Phone</label>
                <input name="phone" class="form-input" placeholder="+92 3XX XXXXXXX">
            </div>
            <div>
                <label class="form-label">Department</label>
                <input name="department" class="form-input" placeholder="Computer Science">
            </div>
            <div>
                <label class="form-label">Event</label>
                <select name="event_id" class="form-input" required>
                    <option value="">Select an event</option>
                    {% for event in events %}
                    <option value="{{ event.id }}">{{ event.title }} · {{ event.start_date.strftime('%b %d') }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="md:col-span-2 flex justify-end">
                <button class="btn-primary">Submit Registration</button>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="flex items-center justify-between mb-4">
            <div>
                <h2 class="text-xl font-semibold">Registration Queue</h2>
                <p class="text-sm text-gray-500">Latest submissions</p>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="text-left text-xs uppercase tracking-wide text-gray-500">
                    <tr>
                        <th class="pb-3 pr-6">Student</th>
                        <th class="pb-3 pr-6">Event</th>
                        <th class="pb-3 pr-6">Date</th>
                        <th class="pb-3 pr-6">Status</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for reg in registrations %}
                    <tr>
                        <td class="py-3 pr-6 font-semibold text-gray-800">{{ reg.student_name }}</td>
                        <td class="py-3 pr-6 text-gray-500">{{ reg.event.title }}</td>
                        <td class="py-3 pr-6 text-gray-500">{{ reg.created_at.strftime('%b %d, %Y') }}</td>
                        <td class="py-3 pr-6">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold capitalize {{ 'bg-green-100 text-green-600' if reg.status == 'approved' else 'bg-yellow-100 text-yellow-700' }}">{{ reg.status }}</span>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td class="py-4 text-gray-500" colspan="4">No registrations yet.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>
{% endblock %}

